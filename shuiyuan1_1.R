#this script is based R 3.4.2 
#this script is used to analyze source of tax
#TIME: 2017-11-6 17:24:XX

library(RODBC)
#library(xlsx)
#library(openxlsx)
#library(gdata)
#library(readxl)
#s2_17step1<-odbcConnectExcel2007("new2017s2.xlsx")
options(digits = 16)
s2_17step1<-read.csv("new2017s2.csv")
s2_17type1<-read.csv("new2017s2.csv")

No<-nrow(s2_17step1)
ID<-1:No
except.vector1<-NULL
s2_17step1<-data.frame(ID,s2_17step1)
#step 1 articulation
#No.1
except1<-which(s2_17step1$TA!=s2_17step1$CA+s2_17step1$NCA)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17type1[except1,],"shuiyuan/No_1_1.csv")
#No.2
except1<-which(s2_17step1$inventory<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17type1[except1,],"shuiyuan/No_1_2.csv")
#No.3
except1<-which(s2_17step1$FA<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_3.csv")
#No.4
except1<-which(s2_17step1$AP<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_4.csv")
#No.5
except1<-which(s2_17step1$CA<0|s2_17step1$BY<0|s2_17step1$CL<0|s2_17step1$STL<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
except1<-which(s2_17step1$PIC<0|s2_17step1$CR<0|s2_17step1$SR<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_5.csv")
#No.6
except1<-which(s2_17step1$VAT_output<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_6.csv")
#No.7
except1<-which(s2_17step1$SE<0|s2_17step1$GAE<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_7.csv")
#No.8
except1<-which(s2_17step1$TTP<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_8.csv")
#No.9
except1<-which(s2_17step1$CDP<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_9.csv")
#No.10
except1<-which(s2_17step1$GAE_RDE<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_10.csv")
#No.11
except1<-which(s2_17step1$CA<s2_17step1$inventory)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_11.csv")
#No.12
except1<-which(s2_17step1$NCA<s2_17step1$FA)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_12.csv")
#No.13
except1<-which(s2_17step1$TL!=s2_17step1$CL+s2_17step1$NCL)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_13.csv")
#No.14
except1<-which(!abs(s2_17step1$TA-s2_17step1$TL-s2_17step1$equity)<1e-4)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_14.csv")
#No.15
except1<-which(s2_17step1$TTP<(s2_17step1$Paid_in_VAT+s2_17step1$PCIT))
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_15.csv")
#No.16
except1<-which(s2_17step1$VAT_output<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_16.csv")
#No.17
except1<-which(s2_17step1$VAT_input<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_17.csv")
#No.18
except1<-which(s2_17step1$VAT_TCS<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_18.csv")
#No.19
except1<-which(s2_17step1$Export_re<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_19.csv")
#No.20
except1<-which(s2_17step1$PCIT<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_20.csv")
#No.21
except1<-which(s2_17step1$Reduction_VAT<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_21.csv")
#No.22
except1<-which(s2_17step1$Reduction_BIT<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_22.csv")
#No.23
except1<-which(s2_17step1$ITCIT<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_23.csv")
#No.24
except1<-which(s2_17step1$import_tariff<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_24.csv")
#No.25
except1<-which(s2_17step1$import_VAT<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_25.csv")
#No.26
except1<-which(s2_17step1$wage<0|s2_17step1$AFS<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_26.csv")
#No.27
except1<-which(s2_17step1$export<0|s2_17step1$import<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_27.csv")
#No.28
except1<-which(s2_17step1$electricity<0|s2_17step1$water<0|s2_17step1$employment<0)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_28.csv")
#No.29
except1<-which(s2_17step1$Total_profit!=s2_17step1$income_Tax+s2_17step1$NP)
s2_17step1<-s2_17step1[-except1,]
except.vector1<-c(except.vector1,s2_17step1[except1,]$ID)
write.csv(s2_17step1[except1,],"shuiyuan/No_1_29.csv")

except.vector1s<-sort(except.vector1)
#final result
s2.result1<-s2_17type1[-except.vector1s,]
s2.result2<-s2_17type1[except.vector1s,]
write.csv(s2.result1,"result1.csv")
write.csv(s2.result2,"result2.csv")

